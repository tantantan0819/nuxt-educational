(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{478:function(e,t,o){},479:function(e,t,o){"use strict";o(35),o(90),o(34);var n=o(5),r=o(55),l=o(7),c={props:["config"],data:function(){return{qiniu_url:"",configuration:{isShowList:!1,multiple:!1,limit:null,btnText:"上传",isPrompt:"",errorText:"请上传PNG、JPG、PDF、WORD、EXCEL格式的文件!",accept:".jpg, .jpeg, .png, .pdf, .excel, .docx,.psd,.PSD, .JPG, .JPEG, PNG, .PDF, .EXCEL, .DOCX"},postData:{token:"",name:"",key:""},tokenParams:{bucket:"ukec",path:"upload/user",ext:""},fileList:[]}},mounted:function(){this.configuration=this.config,this.qiniu_url=l.a.qiniu_url},methods:{beforUpload:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function o(){var n;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return n=t,e.size/1024/1024<30||n.$message({message:"请上传大小不能超过30MB的文件!",type:"warning"}),n.tokenParams.ext=e.name.split(".")[1],n.postData.name=e.name,o.next=7,n.uploadToken();case 7:case"end":return o.stop()}}),o)})))()},uploadToken:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e,t.next=3,r.a.get("/qiniu/token",e.tokenParams).then((function(e){o.postData.token=e.token,o.postData.key=e.key}));case 3:case"end":return t.stop()}}),t)})))()},handleRemove:function(e,t){this.flieBox=t,this.$emit("uploadFile",t)},handleExceed:function(e,t){this.$message.warning("当前限制选择"+this.configuration.limit+"个文件，本次选择了 ".concat(e.length," 个文件，共选择了 ").concat(e.length+t.length," 个文件"))},uploadError:function(){this.$message.error(this.configuration.errorText)},successUpload:function(e,t,o){this.flieBox=o,this.$emit("uploadFile",o),"false"!=this.configuration.isPrompt&&this.$message({message:"上传成功！",type:"success"})}}},m=(o(480),o(10)),component=Object(m.a)(c,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"upload"},[o("el-upload",{staticClass:"upload-demo",attrs:{action:e.qiniu_url,data:e.postData,"before-upload":e.beforUpload,"on-success":e.successUpload,"on-remove":e.handleRemove,"show-file-list":e.configuration.isShowList,limit:e.configuration.limit,multiple:e.configuration.multiple,"on-exceed":e.handleExceed,"file-list":e.fileList,"on-error":e.uploadError,accept:e.configuration.accept}},[e._v(e._s(e.configuration.btnText))])],1)}),[],!1,null,"331b40b8",null);t.a=component.exports},480:function(e,t,o){"use strict";var n=o(478);o.n(n).a},482:function(e,t,o){"use strict";o.d(t,"a",(function(){return c})),o.d(t,"b",(function(){return m})),o.d(t,"c",(function(){return d}));var n=/^1[345789]\d{9}$/,r=/^\w+@\w+(?:\.\w+)+$/,l=/[a-z0-9]{6,16}/,c=function(e,t,o){t?l.test(t)?o():o(new Error("请输入6-16位字母和数字组合的密码")):o(new Error("请输入密码"))},m=function(e,t,o){t?r.test(t)?o():o(new Error("请输入正确的电子邮箱格式")):o(new Error("请输入邮箱号码"))},d=function(e,t,o){t?n.test(t)?o():o(new Error("请输入正确的手机号码")):o(new Error("请输入手机号码"))}},500:function(e,t,o){},544:function(e,t,o){"use strict";var n=o(500);o.n(n).a},580:function(e,t,o){"use strict";o.r(t);var n=o(482),r=o(4),l=o(479),c=(o(7),o(55)),m={layout:"refactor",components:{UploadBtn:l.a},data:function(){var e=this;return{configuration:{isShowList:!1,multiple:!1,limit:100,btnText:"修改头像",errorText:"请上传PNG、JPG格式的文件!",accept:".jpg, .jpeg, .png, .JPG, .JPEG, PNG",isPrompt:"false"},codeImg:"",region:[],person:{},avatar:"",isSendEmail:!0,isSendPhone:!0,emailTime:60,phoneTime:60,visiblePssword:!1,visiblePhone:!1,visibleEmail:!1,fileList:[],passwordForm:{new_password:"",confirm:"",password_reset_token:""},passwordRules:{new_password:[{required:!0,validator:n.a,trigger:"blur"}],confirm:[{required:!0,validator:function(t,o,n){o?o!=e.passwordForm.new_password?n(new Error("请确认你的新密码")):n():n(new Error("请再次输入新密码"))},trigger:"blur"}]},phoneForm:{region:"",code:"",graphic:"",phone:"",type:"1"},phoneRules:{phone:[{required:!0,validator:n.c,trigger:"blur"}],graphic:[{required:!0,message:"请输入图形验证码",trigger:"blur"}],code:[{required:!0,message:"请输入短信验证码",trigger:"blur"}]},emailForm:{email:"",code:""},emailRules:{email:[{password:!0,validator:n.b,trigger:"blur"}],code:[{password:!0,message:"请输入邮箱验证码",trigger:"blur"}]}}},mounted:function(){var e=this;e.active=location.pathname,c.a.get("/user/detail").then((function(t){t&&(e.$store.commit("user/SET_USER",t),e.person=t)}));var t=Object(r.e)("regionList");t?(e.region=t,e.regex=t[0].regex):c.a.get("/region/list").then((function(t){e.region=t,e.regex=t[0].regex,Object(r.k)("regionList",t)})),0!=e.region.length&&(e.phoneForm.region=e.region[0].region),e.changeGraphic()},methods:{addFile:function(e){var t=this,o=e[e.length-1].response.data.url;c.a.post("user/edit",{avatar:o}).then((function(e){e&&(t.$message({message:"头像修改成功！",type:"success"}),t.person.avatar=o,t.$store.commit("user/SET_USER",t.person))})).catch((function(e){t.$message({message:"头像修改失败！",type:"error"})}))},changeGraphic:function(){var e=this;c.a.get("/verify/captcha").then((function(t){e.codeImg=t.base64_images}))},areaSelect:function(e){0!=this.region.length&&(this.regex=this.region.filter((function(t){return t.region==e}))[0].regex)},submitEmail:function(e){var t=this;t.$refs[e].validate((function(e){e&&(c.a.post("/security/bind-email",t.emailForm).then((function(e){e&&t.$message({message:"邮箱修改成功！",type:"success"})})),t.visibleEmail=!1)}))},submitPhone:function(e){var t=this;t.$refs[e].validate((function(e){e&&(c.a.post("/security/bind-email",t.phoneForm).then((function(e){e&&t.$message({message:"手机修改成功！",type:"success"})})),t.visiblePhone=!1)}))},submitPassword:function(e,t){var o=this;o.$refs[e].validate((function(e){e&&(c.a.post("/password/set",o.passwordForm).then((function(e){e&&o.$message({message:"密码修改成功！",type:"success"})})),o.visiblePssword=!1)}))},sendCode:function(e){var t=this;"phone"==e&&t.isSendPhone&&t.$refs.phoneForm.validateField("phone",(function(e){""==e?t.$refs.phoneForm.validateField("graphic",(function(e){if(""==e){var o={code:t.phoneForm.graphic,phone:t.phoneForm.phone,region:t.phoneForm.region,type:"1"};c.a.post("/verify/send-phone",o).then((function(e){if(e){t.isSendPhone=!1,t.$message({message:"手机证码发送成功！",type:"success"});var o=setInterval((function(){t.phoneTime--,0==t.phoneTime&&(t.isSendPhone=!0,t.phoneTime=60,clearInterval(o))}),1e3)}})).catch((function(e){t.isSendPhone=!0}))}else t.$message({message:e,type:"error"})})):t.$message({message:e,type:"error"})})),"email"==e&&t.isSendEmail&&t.$refs.emailForm.validateField("email",(function(e){if(""==e){var o={email:t.emailForm.email,type:"1"};c.a.post("/verify/send-email",o).then((function(e){if(t.isSendEmail=!1,e){t.$message({message:"邮箱验证码发送成功！",type:"success"});var o=setInterval((function(){t.emailTime--,0==t.emailTime&&(t.isSendEmail=!0,t.emailTime=60,clearInterval(o))}),1e3)}})).catch((function(e){t.isSendEmail=!0}))}else t.$message({message:e,type:"error"})}))}}},d=(o(544),o(10)),component=Object(d.a)(m,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"cv con add_note "},[o("div",{staticClass:"cv_step2"},[e._m(0),e._v(" "),o("div",{staticClass:"person_content"},[o("div",{staticClass:"person_item"},[o("span",{staticClass:"title"},[e._v("头像")]),e._v(" "),e.person.avatar?o("span",{staticClass:"con"},[o("img",{attrs:{src:e.person.avatar,alt:""}})]):o("span",{staticClass:"con"},[o("img",{attrs:{src:"/images/avatar.jpg",alt:""}})]),e._v(" "),o("span",{staticClass:"modify"},[o("upload-btn",e._g({attrs:{config:e.configuration}},{uploadFile:e.addFile}))],1)]),e._v(" "),o("div",{staticClass:"person_item"},[o("span",{staticClass:"title"},[e._v("用户名")]),e._v(" "),o("span",{staticClass:"con"},[e._v(e._s(e.person.username||""))])]),e._v(" "),o("div",{staticClass:"person_item"},[o("span",{staticClass:"title"},[e._v("密码")]),e._v(" "),o("span",{staticClass:"con"},[e._v("******")]),e._v(" "),o("span",{staticClass:"modify",on:{click:function(t){e.visiblePssword=!0}}},[o("i",[e._v("修改密码")])])]),e._v(" "),o("div",{staticClass:"person_item"},[o("span",{staticClass:"title"},[e._v("手机号")]),e._v(" "),o("span",{staticClass:"con"},[e._v(e._s(e.person.phone||""))])]),e._v(" "),o("div",{staticClass:"person_item"},[o("span",{staticClass:"title"},[e._v("邮箱")]),e._v(" "),o("span",{staticClass:"con"},[e._v(e._s(e.person.email||""))])]),e._v(" "),o("div",{staticClass:"person_item"},[o("span",{staticClass:"title"},[e._v("生日")]),e._v(" "),o("span",{staticClass:"con"},[e._v(e._s(e.person.birth||""))])])])]),e._v(" "),o("div",{staticClass:"add person_change"},[o("el-dialog",{attrs:{title:"",visible:e.visiblePssword},on:{"update:visible":function(t){e.visiblePssword=t}}},[o("div",{staticClass:"add_title"},[e._v("修改密码")]),e._v(" "),o("div",{staticClass:"add_content"},[o("el-form",{ref:"passwordForm",attrs:{model:e.passwordForm,rules:e.passwordRules,"status-icon":"","label-width":"0"}},[o("el-form-item",{attrs:{prop:"new_password"}},[o("el-input",{attrs:{placeholder:"请输入新密码",autocomplete:"off",type:"password","show-password":""},model:{value:e.passwordForm.new_password,callback:function(t){e.$set(e.passwordForm,"new_password",t)},expression:"passwordForm.new_password"}})],1),e._v(" "),o("el-form-item",{attrs:{prop:"confirm"}},[o("el-input",{attrs:{placeholder:"请确认新密码",autocomplete:"off",type:"password","show-password":""},model:{value:e.passwordForm.confirm,callback:function(t){e.$set(e.passwordForm,"confirm",t)},expression:"passwordForm.confirm"}})],1)],1),e._v(" "),o("div",{staticClass:"footer_button active"},[o("span",{on:{click:function(t){e.visiblePssword=!1}}},[o("i",[e._v("取消")])]),e._v(" "),o("span",{on:{click:function(t){return e.submitPassword("passwordForm")}}},[e._v("确认")])])],1)])],1),e._v(" "),o("div",{staticClass:"add person_change"},[o("el-dialog",{attrs:{title:"",visible:e.visiblePhone},on:{"update:visible":function(t){e.visiblePhone=t}}},[o("div",{staticClass:"add_title"},[e._v("修改手机号")]),e._v(" "),o("div",{staticClass:"add_content"},[o("el-form",{ref:"phoneForm",attrs:{model:e.phoneForm,"status-icon":"",rules:e.phoneRules,"label-width":"0px"}},[o("div",{attrs:{id:"isPhone"}},[o("el-form-item",{staticClass:"isRegion"},[o("el-select",{attrs:{placeholder:"请选择区号"},on:{change:e.areaSelect},model:{value:e.phoneForm.region,callback:function(t){e.$set(e.phoneForm,"region",t)},expression:"phoneForm.region"}},e._l(e.region,(function(t,n){return o("el-option",{key:n,attrs:{label:t.region,value:t.region}},[e._v(e._s(t.region))])})),1)],1),e._v(" "),o("el-form-item",{staticClass:"isPhone",attrs:{prop:"phone"}},[o("el-input",{attrs:{placeholder:"请输入手机号",autocomplete:"off"},model:{value:e.phoneForm.phone,callback:function(t){e.$set(e.phoneForm,"phone",e._n(t))},expression:"phoneForm.phone"}})],1)],1),e._v(" "),o("div",{attrs:{id:"graphic"}},[o("el-form-item",{attrs:{prop:"graphic"}},[o("el-input",{attrs:{type:"text",placeholder:"请输入图形验证码",autocomplete:"off"},model:{value:e.phoneForm.graphic,callback:function(t){e.$set(e.phoneForm,"graphic","string"==typeof t?t.trim():t)},expression:"phoneForm.graphic"}})],1),e._v(" "),o("img",{attrs:{src:e.codeImg,alt:""},on:{click:e.changeGraphic}})],1),e._v(" "),o("div",{staticClass:"code"},[o("el-form-item",{attrs:{prop:"code"}},[o("el-input",{attrs:{type:"text",placeholder:"请输入短信验证码",autocomplete:"off"},model:{value:e.phoneForm.code,callback:function(t){e.$set(e.phoneForm,"code","string"==typeof t?t.trim():t)},expression:"phoneForm.code"}})],1),e._v(" "),o("el-button",{staticClass:"sendCode",attrs:{type:"primary"},on:{click:function(t){return e.sendCode("phone")}}},[e._v(e._s(e.isSendEmail?"发送验证码":e.phoneTime+"秒后可重新发送"))])],1)]),e._v(" "),o("div",{staticClass:"footer_button active"},[o("span",{on:{click:function(t){e.visiblePhone=!1}}},[o("i",[e._v("取消")])]),e._v(" "),o("span",{on:{click:e.submitPhone}},[e._v("确认")])])],1)])],1),e._v(" "),o("div",{staticClass:"add person_change"},[o("el-dialog",{attrs:{title:"",visible:e.visibleEmail},on:{"update:visible":function(t){e.visibleEmail=t}}},[o("div",{staticClass:"add_title"},[e._v("修改邮箱")]),e._v(" "),o("div",{staticClass:"add_content"},[o("el-form",{ref:"emailForm",attrs:{model:e.emailForm,rules:e.emailRules,"status-icon":"","label-width":"0"}},[o("el-form-item",{attrs:{prop:"email"}},[o("el-input",{attrs:{placeholder:"请输入新的邮箱",autocomplete:"off"},model:{value:e.emailForm.email,callback:function(t){e.$set(e.emailForm,"email",t)},expression:"emailForm.email"}})],1),e._v(" "),o("div",{staticClass:"code"},[o("el-form-item",{attrs:{prop:"code"}},[o("el-input",{attrs:{type:"text",placeholder:"请输入邮箱验证码",autocomplete:"off"},model:{value:e.emailForm.code,callback:function(t){e.$set(e.emailForm,"code","string"==typeof t?t.trim():t)},expression:"emailForm.code"}})],1),e._v(" "),o("el-button",{staticClass:"sendCode",attrs:{type:"primary"},on:{click:function(t){return e.sendCode("email")}}},[e._v(e._s(e.isSendEmail?"发送验证码":e.emailTime+"秒后可重新发送"))])],1)],1),e._v(" "),o("div",{staticClass:"footer_button active"},[o("span",{on:{click:function(t){e.visibleEmail=!1}}},[o("i",[e._v("取消")])]),e._v(" "),o("span",{on:{click:function(t){return e.submitEmail("emailForm")}}},[e._v("确认")])])],1)])],1)])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"version_title"},[t("span",[this._v("个人设置")])])}],!1,null,null,null);t.default=component.exports}}]);